# mobx-async-action

Gracefully write mobx async actions.

## Install

```bash
npm install --save mobx-async-action

# or var yarn
yarn add mobx-async-action
```

## Quick Start

This library make it graceful to write async mobx actions.

Your code before:

```typescript
import { observable, runInAction } from 'mobx';

class TodoStore {
  @observable todos: string[] = [];
  @observable fetchingTodos = true;
  @observable fetchTodosError: any = void 0;

  async fetchTodos(page: number) {
    try {
      runInAction(() => {
        this.fetchingTodos = true;
      });
      const todos = await (await fetch(`/todos?page=${page}`)).json();
      runInAction(() => {
        this.todos = todos;
        this.fetchingTodos = false;
        this.fetchTodosError = void 0;
      });
    } catch (err) {
      runInAction(() => {
        this.fetchingTodos = false;
        this.fetchTodosError = err;
      });
    }
  }
}
```

With `mobx-async-action`:

```typescript
import { observable } from 'mobx';
import { asyncAction } from './src'; // replace './src' with 'mobx-async-action'

class TodoStore {
  @observable todos: string[] = [];

  fetchTodos = asyncAction(
    (page: number) => fetch(`/todos?page=${page}`).then((r) => r.json()),
    (todos) => (this.todos = todos),
  );
}
```

## Full Example

```typescript jsx
import { observable } from 'mobx';
import { observer } from 'mobx-react';
import React, { Component } from 'react';
import { asyncAction } from './src'; // replace './src' with 'mobx-async-action'

class TodoStore {
  @observable todos: string[] = [];

  fetchTodos = asyncAction(
    (page: number) => fetch(`/todos?page=${page}`).then((r) => r.json()),
    (todos) => (this.todos = todos),
    () => void 0,
  );
}

const todo = new TodoStore();

@observer
class App extends Component {
  constructor() {
    super();
    todo.fetchTodos(0);
  }

  private loadMore = () => {
    todo.fetchTodos(1);
  };

  render() {
    return (
      <div>
        <ul>
          {todo.todos.map((item, index) => (
            <li key={index}>{item}</li>
          ))}
        </ul>
        <div onClick={this.loadMore}>
          {todo.fetchTodos.pending
            ? 'Loading...'
            : todo.fetchTodos.rejected
            ? todo.fetchTodos.lastError.toString()
            : 'Load more'}
        </div>
      </div>
    );
  }
}
```

## LICENSE

MIT
