"use strict";
/*!
 * Copyright 2019 acrazing <joking.young@gmail.com>. All rights reserved.
 * @since 2019-04-17 13:25:51
 */
Object.defineProperty(exports, "__esModule", { value: true });
const lodash_1 = require("lodash");
function resolveHandlers(module, pool = {}) {
    if (!module) {
        return pool;
    }
    const keys = Object.getOwnPropertyNames(module);
    keys.forEach((key) => {
        if (pool[key]) {
            return;
        }
        const match = key.match(/^handle([A-Z][a-z$]+)([A-Z][A-Za-z]+)$/);
        if (!match) {
            return;
        }
        pool[key] =
            lodash_1.lowerFirst(match[1].replace(/\$/g, '-')) + '.' + lodash_1.lowerFirst(match[2]);
    });
    return resolveHandlers(Object.getPrototypeOf(module), pool);
}
function mountHandlers(module, client) {
    const pool = resolveHandlers(module);
    for (const key in pool) {
        if (pool.hasOwnProperty(key)) {
            client.use(pool[key], module[key]);
        }
    }
}
exports.mountHandlers = mountHandlers;
function unmountHandlers(module, client) {
    const pool = resolveHandlers(module);
    for (const key in pool) {
        if (pool.hasOwnProperty(key)) {
            client.off(pool[key], module[key]);
        }
    }
}
exports.unmountHandlers = unmountHandlers;
